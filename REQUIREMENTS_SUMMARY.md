# 学习心理诊断工具 - 用户需求文档

## 项目概述

开发一个基于大模型的学习心理诊断工具，通过3-5轮温暖的心理咨询对话，深入理解用户的学习心理状态，并生成专业的心理诊断报告。

## 核心功能需求

### 1. 首页设计

#### 1.1 顶部导航栏
- 左侧：❤️ 品牌 Logo + "心理透镜 / Psyche Lens" 品牌名称
- 右侧：用户信息显示（欢迎，[用户名] ➜ 登出）

#### 1.2 主标题和副标题
- 主标题：**选择你的心境场景**（"心境场景"用红色 #ff6b6b 高亮）
- 副标题：通过 3-5 轮温暖对话，我们将深入理解你的学习心理状态

#### 1.3 三个场景卡片
每个卡片包含以下元素：

**场景 1：失意之径**
- 表情符号：😔
- 副标题：努力后却考砸了
- 描述：当付出努力后却未获得预期成果，内心的失落与困惑油然而生...
- 链接文字：进入此场景 →

**场景 2：深谷挑战**
- 表情符号：🤔
- 副标题：深夜遇难题卡住
- 描述：面对困难题目，感到无助和困顿，思维陷入僵局...
- 链接文字：进入此场景 →

**场景 3：意志荒漠**
- 表情符号：📱
- 副标题：想放弃去刷视频
- 描述：学习动力消退，诱惑不断增加，坚持变得困难...
- 链接文字：进入此场景 →

卡片样式：
- 背景：白色
- 圆角：12px
- 边框：1px solid #f0f0f0
- 阴影：0 2px 8px rgba(0, 0, 0, 0.06)
- Hover 效果：向上浮起 2px，阴影加强

#### 1.4 底部 - 四个核心维度
- 标题：**我们将评估四个核心维度**（"四个核心维度"用红色 #ff6b6b 高亮）
- 背景：浅粉色 #fdf0f5，圆角 12px
- 布局：4 个独立的白色卡片，网格布局
- 卡片内容：

| 维度 | 颜色 | 描述 |
|------|------|------|
| 归因风格 | 红色 #ff6b6b | 如何解释失败 |
| 自我效能感 | 绿色 #52c41a | 对自己的信心 |
| 认知负荷 | 黄色 #faad14 | 心理压力程度 |
| 元认知 | 蓝色 #1890ff | 学习意识能力 |

### 2. 对话页面

#### 2.1 页面布局
- 只显示对话框，占满整个页面宽度
- 移除雷达图和分值卡片（这些内容在最终报告时显示）

#### 2.2 顶部导航栏
- 左侧：← 返回首页 按钮
- 中间：场景名称（带表情符号）
- 右侧：进度显示（进度: X/4 轮）

#### 2.3 对话框
- 微信风格的对话气泡
- 用户消息：右对齐，蓝色气泡，用户头像 👤
- AI 消息：左对齐，灰色气泡，AI 头像 🧠
- 自动滚动到最新消息

#### 2.4 用户输入区域
- 文本输入框：高度 90px，占满宽度
- 提示文字：请详细描述你的想法和感受...
- 提交按钮：📤 提交回答
- 返回按钮：🏠 返回

#### 2.5 智能验证
- 如果用户输入为空，显示警告：⚠️ 请输入你的回答
- 如果用户输入少于 5 个字符，显示提示：💡 你的回答有点简短，能否详细一些呢？

#### 2.6 完成提示
- 3 个问题完成后，显示成功提示：✅ 诊断完成！现在可以查看你的心理诊断报告。
- 显示生成报告按钮

### 3. 对话流程

#### 3.1 初始化
- 显示欢迎语（根据场景定制）
- 生成第一个心理咨询问题

#### 3.2 对话轮次
- 第 1 轮：用户回答第一个问题
- 第 2 轮：用户回答第二个问题
- 第 3 轮：用户回答第三个问题
- 第 4 轮：生成分析总结和诊断报告

#### 3.3 问题生成
- 使用硅基流动的 DeepSeek-V3 模型生成动态问题
- 每个问题基于用户的前一个回答进行深化
- 问题应该是开放式的、同情的、专业的

### 4. 大模型集成

#### 4.1 API 配置
- 平台：硅基流动（SiliconFlow）
- 模型：deepseek-ai/DeepSeek-V3
- API 地址：https://api.siliconflow.cn/v1/chat/completions
- API Key：[用户提供]

#### 4.2 API 调用参数
```json
{
  "model": "deepseek-ai/DeepSeek-V3",
  "messages": [{"role": "user", "content": "prompt"}],
  "stream": false,
  "max_tokens": 1000,
  "temperature": 0.7,
  "top_p": 0.7,
  "top_k": 50,
  "frequency_penalty": 0.5,
  "n": 1,
  "response_format": {"type": "text"}
}
```

#### 4.3 错误处理和重试
- 自动重试机制（最多 2 次）
- 503 错误时等待 3 秒后重试
- 429 错误（请求过于频繁）时等待 5 秒后重试
- 401 错误（认证失败）时显示错误提示
- 超时和连接错误时等待 2 秒后重试
- API 调用失败时自动使用预设的心理咨询问题

#### 4.4 提示词设计

**第一个问题的提示词：**
```
你是一位专业的心理咨询师。用户选择了'[场景名称]'场景。请生成一个开放式的心理咨询问题，帮助用户探索他们的心理状态。问题应该简洁、同情、专业。只返回问题本身，不要有其他内容。
```

**后续问题的提示词：**
```
你是一位专业的心理咨询师。用户在'[场景名称]'场景中。用户之前的回答是：'[用户回答]'。这是第[轮数]个问题。请生成一个后续的心理咨询问题，深入探索用户的心理状态。问题应该基于用户的回答，更深入地了解他们的想法和感受。只返回问题本身，不要有其他内容。
```

**分析总结的提示词：**
```
用户在'[场景名称]'场景中完成了3轮心理咨询对话。用户的回答显示了他们的心理状态。请生成一个专业的、鼓励性的分析总结（2-3句话），评价用户的心理状态和成长潜力。
```

### 5. 数据收集和评分

#### 5.1 分值评估
- 四个维度的分值范围：0-100 分
- 初始分值：50 分
- 根据用户回答长度和轮数动态调整分值

#### 5.2 场景特定的评分逻辑

**失意之径：**
- 归因风格：+8 分/轮
- 自我效能感：+6 分/轮
- 认知负荷：-4 分/轮

**深谷挑战：**
- 元认知：+10 分/轮
- 自我效能感：+8 分/轮

**意志荒漠：**
- 自我效能感：+12 分/轮
- 认知负荷：-6 分/轮

### 6. 最终报告页面

#### 6.1 报告内容
- 雷达图：显示四个维度的分值
- 分值卡片：显示每个维度的具体分值
- 分析总结：AI 生成的专业分析
- 建议：基于诊断结果的个性化建议

#### 6.2 报告导出
- 支持下载 PDF 格式报告
- 支持分享报告链接

## 技术需求

### 7.1 前端框架
- Streamlit（Python Web 框架）
- Plotly（动态雷达图）

### 7.2 后端
- Python 3.11+
- requests 库（API 调用）
- python-dotenv（环境变量管理）

### 7.3 部署
- 本地开发：streamlit run app.py
- 生产环境：Streamlit Cloud 或自托管

## 设计规范

### 8.1 颜色方案
- 品牌红色：#ff6b6b
- 主文字：#333
- 副文字：#666
- 浅灰色：#999
- 浅粉色背景：#fdf0f5
- 链接蓝色：#667eea

### 8.2 字体大小
- 主标题：42px
- 副标题：16px
- 卡片标题：18px
- 卡片副标题：13px
- 卡片描述：12px
- 维度标题：16px
- 维度描述：14px

### 8.3 间距
- 卡片圆角：12px
- 卡片内边距：28px 20px
- 卡片间距：24px
- 维度部分内边距：40px 48px

## 用户流程

1. 用户访问首页
2. 选择三个场景之一
3. 进入对话页面
4. 完成 3 轮对话
5. 查看心理诊断报告
6. 下载或分享报告

## 非功能需求

- 响应式设计：支持桌面和平板
- 性能：API 调用响应时间 < 5 秒
- 可用性：友好的错误提示和引导
- 安全性：API Key 安全存储，不在前端暴露

## 备注

- 所有 git 提交记录使用中文
- 代码注释使用中文
- 用户界面文本使用中文
- 支持 API 调用失败时的优雅降级

